<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      body {
        font-family: "Tajawal", sans-serif;
      }
      .sidebar:hover {
        width: 220px;
      }
      .sidebar:hover .link-text {
        display: inline;
      }
      .input-style {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #fff;
      }

      /** Tailwind Custom Animation -->**/
      @keyframes spin-slow {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .animate-spin-slow {
        animation: spin-slow 2s linear infinite;
      }
      .animate-fade-in {
        animation: fade-in 0.5s ease-out forwards;
      }
      @keyframes fade-in {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="flex h-screen">
      <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
      <aside
        class="sidebar bg-gradient-to-b from-gray-900 to-gray-800 text-white w-16 hover:w-56 transition-all duration-300 overflow-hidden shadow-lg"
      >
        <div class="flex flex-col h-full p-2 space-y-6 pt-6">
          <div class="flex items-center space-x-2 px-4 mb-4">
            <i data-lucide="layout-dashboard" class="w-6 h-6 text-blue-400"></i>
            <span class="link-text hidden font-semibold text-lg"
              >Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span
            >
          </div>

          <button
            onclick="loadContent('home')"
            class="flex items-center space-x-2 px-4 py-3 rounded hover:bg-gray-800 transition text-right"
          >
            <i data-lucide="home" class="w-7 h-7 text-yellow-400"></i>
            <span class="link-text hidden">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
          </button>
          <button
            onclick="loadContent('attendance')"
            class="flex items-center space-x-2 px-4 py-3 rounded hover:bg-blue-800 transition text-right"
          >
            <i data-lucide="clock-9" class="w-7 h-7 text-blue-300"></i>
            <span class="link-text hidden">Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</span>
          </button>
          <button
            onclick="loadContent('housing')"
            class="flex items-center space-x-2 px-4 py-3 rounded hover:bg-green-800 transition text-right"
          >
            <i data-lucide="cable" class="w-7 h-7 text-green-300"></i>
            <span class="link-text hidden">Ø§Ù„ØªØ³ÙƒÙŠÙ†</span>
          </button>
          <button
            onclick="loadContent('repayment')"
            class="flex items-center space-x-2 px-4 py-3 rounded hover:bg-purple-800 transition text-right"
          >
            <i
              data-lucide="circle-dollar-sign"
              class="w-7 h-7 text-purple-300"
            ></i>
            <span class="link-text hidden">Repayment</span>
          </button>

          <button
            onclick="loadContent('addEmployee')"
            class="flex items-center space-x-2 px-4 py-3 rounded hover:bg-orange-800 transition text-right"
          >
            <i data-lucide="user-plus" class="w-7 h-7 text-orange-400"></i>
            <span class="link-text hidden">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</span>
          </button>
        </div>
      </aside>

      <!-- Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
      <main
        class="flex-1 p-8 bg-white rounded-l-3xl shadow-inner overflow-y-auto"
      >
        <div id="mainContent">
          <h1 class="text-3xl font-bold text-gray-800 mb-4">ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ</h1>
          <p class="text-gray-600">
            Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©.
          </p>
        </div>
      </main>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ­Ù…ÙŠÙ„ Ø²Ø¬Ø§Ø¬ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© -->
    <div
      id="loaderOverlay"
      class="fixed inset-0 bg-black bg-opacity-30 backdrop-blur-md flex justify-center items-center z-50 hidden"
    >
      <div
        class="bg-white dark:bg-gray-900 bg-opacity-70 dark:bg-opacity-80 px-8 py-6 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 flex flex-col items-center space-y-4 animate-fade-in"
      >
        <!-- Animation -->
        <div class="relative w-16 h-16">
          <div
            class="absolute inset-0 border-4 border-blue-500 border-dashed rounded-full animate-spin-slow"
          ></div>
          <div
            class="absolute inset-2 bg-blue-500 rounded-full shadow-inner animate-ping"
          ></div>
        </div>
        <!-- Text -->
        <p class="text-lg font-semibold text-gray-800 dark:text-gray-200">
          Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </p>
        <p class="text-sm text-gray-500 dark:text-gray-400">
          Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù†ØªØ¸Ø±
          <span id="countdown" class="text-blue-600 font-bold">0</span> Ø«Ø§Ù†ÙŠØ©...
        </p>
      </div>
    </div>

    <!-- Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØµÙØ­Ø© -->
    <script>
      lucide.createIcons();

      let lastDataTime = null;

      function loadContent(section) {
        const main = document.getElementById("mainContent");

        if (section === "attendance") {
          main.innerHTML = `
      <h2 class="text-2xl font-bold text-blue-800 mb-4">ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</h2>
      <div class="flex flex-wrap gap-4 items-center bg-blue-50 p-4 rounded shadow mb-4">
        <input type="text" id="searchName" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ..." class="px-4 py-2 border border-gray-300 rounded w-full md:w-1/3" oninput="filterTable()" />
        <div class="flex items-center gap-2">
          <label for="fromDate" class="text-sm text-gray-700">Ù…Ù†:</label>
          <input type="date" id="fromDate" class="px-2 py-1 border rounded" onchange="filterTable()" />
        </div>
        <div class="flex items-center gap-2">
          <label for="toDate" class="text-sm text-gray-700">Ø¥Ù„Ù‰:</label>
          <input type="date" id="toDate" class="px-2 py-1 border rounded" onchange="filterTable()" />
        </div>
        
        <button onclick="fetchNewAttendance()" class="ml-auto bg-blue-700 text-white px-4 py-2 rounded shadow hover:bg-blue-800 flex items-center gap-2">
          <i data-lucide="refresh-ccw" class="w-4 h-4"></i>
          <span>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
        </button>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-300 rounded shadow">
          <thead class="bg-blue-200 text-blue-900">
            <tr>
              <th class="px-4 py-2 border">Ø§Ù„ÙˆÙ‚Øª</th>
              <th class="px-4 py-2 border">Ø§Ù„Ø§Ø³Ù…</th>
              <th class="px-4 py-2 border">Ø§Ù„Ù…ÙƒØªØ¨</th>
              <th class="px-4 py-2 border">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
              <th class="px-4 py-2 border">Latitude</th>
              <th class="px-4 py-2 border">Longitude</th>
              <th class="px-4 py-2 border">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</th>
            </tr>
          </thead>
          <tbody id="attendanceTableBody"></tbody>
        </table>
      </div>
    `;
          lucide.createIcons();
          fetchNewAttendance();
        } else if (section === "housing") {
          main.innerHTML = `
    <h2 class="text-2xl font-bold text-green-800 mb-4">ğŸ“¦ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ³ÙƒÙŠÙ†</h2>
    <div class="flex flex-wrap gap-4 items-center bg-blue-50 p-4 rounded shadow mb-4">
        <input type="text" id="searchName" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ..." class="px-4 py-2 border border-gray-300 rounded w-full md:w-1/3" oninput="filterTable()" />
  <input type="text" id="searchSiteID" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹..." class="px-4 py-2 border border-gray-300 rounded w-full md:w-1/3" oninput="filterTable()" />
        <button onclick="fetchHousingData()" class="ml-auto bg-blue-700 text-white px-4 py-2 rounded shadow hover:bg-blue-800 flex items-center gap-2">
         <i data-lucide="refresh-ccw" class="w-4 h-4"></i>
          <span>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
        </button>
      </div>
    <div class="overflow-auto rounded shadow border border-gray-300">
      <table class="min-w-full bg-white text-center border border-gray-200">
        <thead id="housingTableHead" class="bg-green-100 text-green-800 font-bold">
          <tr>
              <th class="px-4 py-2 border">Ø§Ù„ÙˆÙ‚Øª</th>
              <th class="px-4 py-2 border">Ù†ÙˆØ¹ Ø§Ù„ØªØ³ÙƒÙŠÙ†</th>
              <th class="px-4 py-2 border">Ø£Ø³Ù… Ø§Ù„ÙÙ†ÙŠ</th>
              <th class="px-4 py-2 border">Ø§Ù„Ù…ÙƒØªØ¨</th>
              <th class="px-4 py-2 border">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙ†Ø¯Ø§</th>
              <th class="px-4 py-2 border">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
              <th class="px-4 py-2 border">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th class="px-4 py-2 border">ØªÙƒØª Ø§Ù„ØªØ³ÙƒÙŠÙ†</th>
              <th class="px-4 py-2 border">Ø³Ø¨Ø¨ Ø§Ù„ØªØ³ÙƒÙŠÙ†</th>
              <th class="px-4 py-2 border">ØªØ±Ø§Ù†Ø³Ù…ÙŠØ´Ù†Â ÙÙ‚Ø· </th>


            </tr>
          </thead>
        <tbody id="housingTableBody"></tbody>
      </table>
    </div>
  `;
          fetchHousingData();
        } else if (section === "repayment") {
          main.innerHTML = `
      <h2 class="text-2xl font-bold text-purple-800 mb-2">ğŸ“¸ ØµÙØ­Ø© Repayment</h2>
      <p class="text-gray-700">Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ± ÙˆØ±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§.</p>
    `;
        } else if (section === "home") {
          main.innerHTML = `
      <h2 class="text-2xl font-bold text-yellow-600 mb-4">ğŸ“Š Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
      <p class="text-gray-700 mb-4">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
      <div class="bg-white p-6 rounded shadow-md w-full max-w-lg mx-auto">
        <canvas id="attendanceChart" width="400" height="400"></canvas>
      </div>
    `;

          setTimeout(() => {
            const ctx = document
              .getElementById("attendanceChart")
              .getContext("2d");
            new Chart(ctx, {
              type: "pie",
              data: {
                labels: ["Ù…Ù†ØªØ¸Ù…", "ÙƒØ«ÙŠØ± Ø§Ù„ØºÙŠØ§Ø¨"],
                datasets: [
                  {
                    label: "Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†",
                    data: [75, 25], // âœï¸ Ø¹Ø¯Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø­Ø³Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
                    backgroundColor: ["#10B981", "#EF4444"],
                    borderWidth: 1,
                  },
                ],
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: "bottom",
                    labels: {
                      font: {
                        size: 14,
                        family: "Tajawal",
                      },
                    },
                  },
                  title: {
                    display: true,
                    text: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±",
                    font: {
                      size: 18,
                    },
                  },
                },
              },
            });
          }, 100);
        } else if (section === "addEmployee") {
          main.innerHTML = `
    <h2 class="text-2xl font-bold text-orange-800 mb-4">ğŸ“Œ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</h2>
    <div class="space-y-6">

      <div class="flex flex-wrap items-start gap-6">
        <!-- Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© -->
        <div class="w-full sm:w-1/4 flex flex-col items-center">
          <label class="mb-2 font-medium text-gray-700">ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù</label>
          <!-- Ù…Ø±Ø¨Ø¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© -->
<label for="photo" class="relative w-48 h-48 bg-gray-200 flex items-center justify-center cursor-pointer hover:bg-gray-300 rounded-xl overflow-hidden">
  <span id="plusIcon" class="text-5xl text-gray-500 absolute">+</span>
  <img id="preview" src="" class="w-full h-full object-cover hidden" style="border-radius: 12px;" />
</label>
<input type="file" id="photo" accept="image/*" class="hidden" onchange="previewImage()" />

<input type="file" id="photo" accept="image/*" class="hidden" onchange="previewImage()" />

        </div>

        <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
        <div class="w-full sm:w-3/4 grid grid-cols-1 md:grid-cols-2 gap-4">

          <input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù" class="input-style" />
          <input type="text" id="nationalId" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ" class="input-style" />

          <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="input-style" />
          <input type="text" id="mobile" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" class="input-style" />

          <input type="text" id="jobTitle" placeholder="Ø§Ù„ÙˆØ¸ÙŠÙØ©" class="input-style" />
          <input type="text" id="project" placeholder="Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" class="input-style" />
          <div>
  <label for="office" class="block text-sm text-gray-600 mb-1">ğŸ¢ Ø§Ù„Ù…ÙƒØªØ¨</label>
  <select id="office" class="input-style">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØªØ¨</option>
    <option value="Ø´Ø¨Ø±Ø§">Ø´Ø¨Ø±Ø§</option>
    <option value="Ø¬Ø³Ø± Ø§Ù„Ø³ÙˆÙŠØ³">Ø¬Ø³Ø± Ø§Ù„Ø³ÙˆÙŠØ³</option>
    <option value="Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†</option>
  </select>
</div>


          <div>
            <label class="block text-sm text-gray-600 mb-1">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
            <input type="date" id="birthDate" class="input-style" />
          </div>
          <div>
            <label class="block text-sm text-gray-600 mb-1">ğŸ—“ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label>
            <input type="date" id="hireDate" class="input-style" />
          </div>

          <input type="text" id="status" placeholder="Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©" class="input-style" />
          <input type="number" id="salary" placeholder="Ø§Ù„Ù…Ø±ØªØ¨ Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡" class="input-style" />

        </div>
      </div>

      <button onclick="submitEmployee()" class="bg-orange-600 text-white px-6 py-3 rounded shadow hover:bg-orange-700">
        â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù
      </button>
    </div>
  `;

          lucide.createIcons();
        }
      }

      function filterBySiteID() {
        const input = document
          .getElementById("searchSiteID")
          .value.trim()
          .toLowerCase();
        const rows = document.querySelectorAll("#housingTableBody tr");

        rows.forEach((row) => {
          const siteID = row.cells[5]?.textContent.toLowerCase() || "";
          if (siteID.includes(input)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function fetchNewAttendance() {
        const overlay = document.getElementById("loaderOverlay");
        const countdownText = document.getElementById("countdown");
        overlay.classList.remove("hidden");

        let seconds = 0;
        countdownText.textContent = seconds;
        const timer = setInterval(() => {
          seconds++;
          countdownText.textContent = seconds;
        }, 1000);

        fetch(
          "https://script.google.com/macros/s/AKfycby5QdbFnpkhnBFkl5el6B2rflE1HcCHTMzV2hERMhbll4veiAESm4ElsQf7Bey3sDzUAQ/exec"
        )
          .then((res) => res.json())
          .then((data) => {
            const tableBody = document.getElementById("attendanceTableBody");
            tableBody.innerHTML = "";

            data.forEach((row) => {
              const tr = document.createElement("tr");
              tr.className = "text-center hover:bg-gray-100 transition";
              tr.innerHTML = `
          <td class="px-4 py-2 border">${row["Ø§Ù„ÙˆÙ‚Øª"]}</td>
          <td class="px-4 py-2 border">${row["Ø§Ù„Ø§Ø³Ù…"]}</td>
          <td class="px-4 py-2 border">${row["Ø§Ù„Ù…ÙƒØªØ¨"]}</td>
          <td class="px-4 py-2 border font-bold ${
            row["Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡"] === "Ø¯Ø®ÙˆÙ„" ? "text-green-600" : "text-red-600"
          }">${row["Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡"]}</td>
          <td class="px-4 py-2 border">${row["Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Latitude)"]}</td>
          <td class="px-4 py-2 border">${row["Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Longitude)"]}</td>
          <td class="px-4 py-2 border"><a href="${
            row["Ø§Ù„ØµÙˆØ±Ø© (Ø±Ø§Ø¨Ø·)"]
          }" target="_blank" class="text-blue-500 underline">Ø¹Ø±Ø¶</a></td>
        `;
              tableBody.appendChild(tr);
            });

            lucide.createIcons();
          })
          .catch((err) => {
            console.error(err);
            alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
          })
          .finally(() => {
            clearInterval(timer);
            overlay.classList.add("hidden");
          });
      }

      function fetchHousingData() {
        const overlay = document.getElementById("loaderOverlay");
        const countdownText = document.getElementById("countdown");
        overlay.classList.remove("hidden");

        let seconds = 0;
        countdownText.textContent = seconds;
        const timer = setInterval(() => {
          seconds++;
          countdownText.textContent = seconds;
        }, 1000);

        fetch(
          "https://script.google.com/macros/s/AKfycbxoeOxRbxrbvYiqS_gtvYJuPMDasV3rbFyg-GyZhR5Scdj30OGhU6wq1jDtfMnWV9G7ig/exec"
        )
          .then((res) => res.json())
          .then((data) => {
            const tableBody = document.getElementById("housingTableBody");
            tableBody.innerHTML = "";

            data.forEach((row) => {
              const tr = document.createElement("tr");
              tr.className = "text-center hover:bg-gray-100 transition";
              tr.innerHTML = `
          <td class="px-4 py-2 border">${formatDateTime(
            row["Date - Time"]
          )}</td>

          <td class="px-4 py-2 border">${row["Ù†ÙˆØ¹ Ø§Ù„ØªØ³ÙƒÙŠÙ†"] || ""}</td>
<td class="px-4 py-2 border">${row["Resource Name"] || ""}</td>
<td class="px-4 py-2 border">${row["Office"] || ""}</td>
<td class="px-4 py-2 border">${row["PG S.N."] || ""}</td>
<td class="px-4 py-2 border">${row["Site ID"] || ""}</td>

<!-- Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ -->
<td class="px-4 py-2 border">${formatDateOnly(row["Date"])}</td>
<td class="px-4 py-2 border">${formatTimeOnly(row["Time"])}</td>

<td class="px-4 py-2 border">${row["Category"] || ""}</td>
<td class="px-4 py-2 border">${row["Fuel spear"] || ""}</td>

        `;
              tableBody.appendChild(tr);
            });
          })
          .catch((err) => {
            console.error(err);
            alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³ÙƒÙŠÙ†.");
          })
          .finally(() => {
            clearInterval(timer);
            overlay.classList.add("hidden");
          });
      }

      function formatDateTime(dateStr) {
        if (!dateStr) return "";
        const date = new Date(dateStr);
        if (isNaN(date)) return dateStr; // Ù„Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø´ ØµØ§Ù„Ø­

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø­Ø³Ø¨ ØªÙˆÙ‚ÙŠØª Ù…ØµØ± (GMT+3)
        return date.toLocaleString("ar-EG", {
          timeZone: "Africa/Cairo",
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function filterTable() {
        const searchName =
          document.getElementById("searchName")?.value.trim() || "";
        const searchSiteID =
          document.getElementById("searchSiteID")?.value.trim() || "";
        const fromDate = document.getElementById("fromDate")?.value || "";
        const toDate = document.getElementById("toDate")?.value || "";

        // Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ³ÙƒÙŠÙ†
        const housingRows = document.querySelectorAll("#housingTableBody tr");
        housingRows.forEach((row) => {
          const name = row.querySelector("td:nth-child(3)")?.textContent || "";
          const siteID =
            row.querySelector("td:nth-child(6)")?.textContent || "";
          const date = row.querySelector("td:nth-child(7)")?.textContent || "";

          let show = true;

          if (searchName && !name.includes(searchName)) show = false;
          if (searchSiteID && !siteID.includes(searchSiteID)) show = false;
          if (fromDate && date < fromDate) show = false;
          if (toDate && date > toDate) show = false;

          row.style.display = show ? "" : "none";
        });

        // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
        const attendanceRows = document.querySelectorAll(
          "#attendanceTableBody tr"
        );
        attendanceRows.forEach((row) => {
          const name = row.querySelector("td:nth-child(2)")?.textContent || "";
          const dateTimeText =
            row.querySelector("td:nth-child(1)")?.textContent || "";
          const dateObj = new Date(dateTimeText.replace(",", ""));

          let show = true;
          if (searchName && !name.includes(searchName)) show = false;

          // ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„
          if (!isNaN(dateObj)) {
            if (fromDate && dateObj < new Date(fromDate)) show = false;
            if (toDate && dateObj > new Date(toDate)) show = false;
          }

          row.style.display = show ? "" : "none";
        });
      }

      function formatDateOnly(dateStr) {
        if (!dateStr) return "";
        const date = new Date(dateStr);
        if (isNaN(date)) return dateStr;

        return date.toLocaleDateString("ar-EG", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
        });
      }

      function formatTimeOnly(timeStr) {
        if (!timeStr) return "";
        const date = new Date("1970-01-01T" + timeStr);
        if (isNaN(date)) return timeStr;

        return date.toLocaleTimeString("ar-EG", {
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function previewImage() {
        const input = document.getElementById("photo");
        const preview = document.getElementById("preview");
        const plusIcon = document.getElementById("plusIcon");

        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = (e) => {
            preview.src = e.target.result;
            preview.classList.remove("hidden");
            plusIcon.classList.add("hidden");
          };
          reader.readAsDataURL(input.files[0]);
        }
      }

      async function submitEmployee() {
  const name = document.getElementById("name").value;
  const nationalId = document.getElementById("nationalId").value;
  const address = document.getElementById("address").value;
  const mobile = document.getElementById("mobile").value;
  const jobTitle = document.getElementById("jobTitle").value;
  const project = document.getElementById("project").value;
  const birthDate = document.getElementById("birthDate").value;
  const hireDate = document.getElementById("hireDate").value;
  const status = document.getElementById("status").value;
  const salary = document.getElementById("salary").value;
  const photo = document.getElementById("photo").files[0];

  if (!name || !photo) {
    alert("âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ø±ÙØ¹ ØµÙˆØ±Ø©.");
    return;
  }

  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Base64
  const reader = new FileReader();
  reader.onloadend = async () => {
    const photoBase64 = reader.result.split(",")[1];

    const payload = {
      name, nationalId, address, mobile, jobTitle, project,
      birthDate, hireDate, status, salary, photoBase64
    };

    try {
      const response = await fetch("https://script.google.com/macros/s/AKfycbx1KPzH7ZrdPOMsGnFbF-4Ud_K6aZd9ux4Vt9TajyxatdMxiIzvMizcY7p21ccAgiju/exec", {
        method: "POST",
        body: JSON.stringify(payload),
        headers: { "Content-Type": "application/json" }
      });

      const result = await response.text();
      Swal.fire("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸", result, "success");
    } catch (err) {
      Swal.fire("âŒ Ø®Ø·Ø£", err.message, "error");
    }
  };

  reader.readAsDataURL(photo);
}

    </script>
  </body>
</html>
